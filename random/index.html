<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Live Sundial - Horizon View</title>
    <style>
        body {
            background: #e0f7fa;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            margin: 0;
            perspective: 1000px;
            flex-direction: column;
        }

        .sundial-container {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            width: 100vw;
        }

        .sundial {
            position: relative;
            width: 320px;
            height: 320px;
            background: #fffde7;
            border-radius: 50%;
            border: 4px solid #bdb76b;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            /* Tilt the sundial so the horizon is at the top */
            transform: rotateX(65deg);
            transform-style: preserve-3d;
        }

        .gnomon {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 8px;
            height: 100px;
            background: #455a64;
            transform-origin: bottom center;
            border-radius: 4px;
            box-shadow: 0 2px 8px #888;
            z-index: 2;
        }

        .shadow {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 6px;
            height: 120px;
            background: rgba(44, 62, 80, 0.3);
            transform-origin: bottom center;
            border-radius: 3px;
            z-index: 1;
            pointer-events: none;
        }

        /* Optional: Hide hour labels for clarity in this view */
        .hour-label {
            display: none;
        }

        #info {
            margin-top: 32px;
            font-family: sans-serif;
            color: #37474f;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="sundial-container">
        <div class="sundial" id="sundial">
            <div class="gnomon" id="gnomon"></div>
            <div class="shadow" id="shadow"></div>
            <!-- Hour labels (hidden in this view, but you can adjust/re-enable) -->
            <div class="hour-label" style="left: 50%; top: 28px; transform: translate(-50%, 0);">12</div>
            <div class="hour-label" style="left: 292px; top: 50%; transform: translate(0, -50%);">3</div>
            <div class="hour-label" style="left: 50%; top: 292px; transform: translate(-50%, 0);">6</div>
            <div class="hour-label" style="left: 28px; top: 50%; transform: translate(0, -50%);">9</div>
        </div>
    </div>
    <div id="info">Locating…</div>
    <script>
        const info = document.getElementById('info');
        let latitude = null, longitude = null;

        function pad(n) { return n < 10 ? '0' + n : n; }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (pos) {
                latitude = pos.coords.latitude;
                longitude = pos.coords.longitude;
                info.textContent = `Latitude: ${latitude.toFixed(4)}, Longitude: ${longitude.toFixed(4)}`;
                startSundial();
            }, function () {
                info.textContent = "Location access denied. Sundial will use UTC.";
                startSundial();
            });
        } else {
            info.textContent = "Geolocation not supported. Sundial will use UTC.";
            startSundial();
        }

        function startSundial() {
            setInterval(updateSundial, 1000);
            updateSundial();
        }

        function updateSundial() {
            const now = new Date();
            let offset = 0;
            if (longitude !== null) {
                offset = longitude / 15;
            }
            let hours = now.getUTCHours() + now.getUTCMinutes() / 60 + now.getUTCSeconds() / 3600 + offset;
            if (hours < 0) hours += 24;
            if (hours >= 24) hours -= 24;

            let hourAngle = (hours - 12) * 15; // degrees
            const shadowAngle = hourAngle + 180;

            // Update shadow
            const shadow = document.getElementById('shadow');
            shadow.style.transform = `translate(-50%, -100%) rotate(${shadowAngle}deg)`;

            // Gnomon remains upright relative to the dial
            const gnomon = document.getElementById('gnomon');
            gnomon.style.transform = `translate(-50%, -100%) rotate(-30deg)`;

            info.innerHTML = `
        <b>Solar Time:</b> ${pad(Math.floor(hours))}:${pad(Math.floor((hours % 1) * 60))}:${pad(Math.floor((hours * 60 % 1) * 60))}<br>
        <b>Hour Angle:</b> ${hourAngle.toFixed(2)}°<br>
        ${latitude ? `<b>Latitude:</b> ${latitude.toFixed(4)}<br>` : ""}
        ${longitude ? `<b>Longitude:</b> ${longitude.toFixed(4)}` : ""}
      `;
        }
    </script>
</body>

</html>